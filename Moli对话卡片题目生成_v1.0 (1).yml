app:
  description: é€šè¿‡å·¥ä½œæµè‡ªåŠ¨ç”Ÿæˆå¯¹è¯å¡ç‰‡é¢˜ç›®å†…å®¹
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: Moliå¯¹è¯å¡ç‰‡é¢˜ç›®ç”Ÿæˆ_v1.0
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai:0.1.0@539dc0dde8ecaa84e61b8eeb154c3bb7fbc9caa80afd83763dd5860a725d2742
kind: app
version: 0.3.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 200
        batch_count_limit: 900
        file_size_limit: 200
        image_file_size_limit: 200
        video_file_size_limit: 200
        workflow_file_upload_limit: 900
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        sourceType: start
        targetType: if-else
      id: 1753336166559-source-1753339672847-target
      selected: false
      source: '1753336166559'
      sourceHandle: source
      target: '1753339672847'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: start
        targetType: if-else
      id: 1753336166559-source-17533396760860-target
      selected: false
      source: '1753336166559'
      sourceHandle: source
      target: '17533396760860'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: start
        targetType: if-else
      id: 1753336166559-source-17533396767300-target
      selected: false
      source: '1753336166559'
      sourceHandle: source
      target: '17533396767300'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: start
        targetType: if-else
      id: 1753336166559-source-17533396773730-target
      selected: false
      source: '1753336166559'
      sourceHandle: source
      target: '17533396773730'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: llm
      id: 17533396773730-true-1753339886438-target
      selected: false
      source: '17533396773730'
      sourceHandle: 'true'
      target: '1753339886438'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: start
        targetType: if-else
      id: 1753336166559-source-1753341814322-target
      selected: false
      source: '1753336166559'
      sourceHandle: source
      target: '1753341814322'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: code
        targetType: template-transform
      id: 1753342022306-source-1753342086794-target
      selected: false
      source: '1753342022306'
      sourceHandle: source
      target: '1753342086794'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: template-transform
        targetType: llm
      id: 1753342086794-source-1753342493873-target
      selected: false
      source: '1753342086794'
      sourceHandle: source
      target: '1753342493873'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: template-transform
      id: 1753342493873-source-1753342707768-target
      selected: false
      source: '1753342493873'
      sourceHandle: source
      target: '1753342707768'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: llm
      id: 1753341814322-true-1753346134162-target
      selected: false
      source: '1753341814322'
      sourceHandle: 'true'
      target: '1753346134162'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: template-transform
        targetType: llm
      id: 17533461952642-source-1753351512925-target
      selected: false
      source: '17533461952642'
      sourceHandle: source
      target: '1753351512925'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: template-transform
      id: 1753351512925-source-17533461952645-target
      selected: false
      source: '1753351512925'
      sourceHandle: source
      target: '17533461952645'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: llm
      id: 17533396767300-true-1753351954442-target
      selected: false
      source: '17533396767300'
      sourceHandle: 'true'
      target: '1753351954442'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: code
        targetType: template-transform
      id: 1753352030500-source-17536688854790-target
      selected: false
      source: '1753352030500'
      sourceHandle: source
      target: '17536688854790'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: template-transform
        targetType: llm
      id: 17536688854790-source-17536688927820-target
      selected: false
      source: '17536688854790'
      sourceHandle: source
      target: '17536688927820'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: template-transform
      id: 17536688927820-source-17536688996950-target
      selected: false
      source: '17536688927820'
      sourceHandle: source
      target: '17536688996950'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: code
      id: 1753351954442-source-1753352030500-target
      selected: false
      source: '1753351954442'
      sourceHandle: source
      target: '1753352030500'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: llm
      id: 17533396760860-true-1753671925489-target
      selected: false
      source: '17533396760860'
      sourceHandle: 'true'
      target: '1753671925489'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: code
      id: 1753671925489-source-1753672356709-target
      selected: false
      source: '1753671925489'
      sourceHandle: source
      target: '1753672356709'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: code
        targetType: template-transform
      id: 1753672356709-source-1753672437742-target
      selected: false
      source: '1753672356709'
      sourceHandle: source
      target: '1753672437742'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: template-transform
        targetType: llm
      id: 1753672437742-source-17536724640920-target
      selected: false
      source: '1753672437742'
      sourceHandle: source
      target: '17536724640920'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: template-transform
      id: 17536724640920-source-17536724676350-target
      selected: false
      source: '17536724640920'
      sourceHandle: source
      target: '17536724676350'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: llm
      id: 1753339672847-true-1753673016249-target
      selected: false
      source: '1753339672847'
      sourceHandle: 'true'
      target: '1753673016249'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: code
      id: 1753673016249-source-1753673086906-target
      selected: false
      source: '1753673016249'
      sourceHandle: source
      target: '1753673086906'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: code
        targetType: template-transform
      id: 1753673086906-source-1753673197346-target
      selected: false
      source: '1753673086906'
      sourceHandle: source
      target: '1753673197346'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: template-transform
        targetType: llm
      id: 1753673197346-source-1753673132811-target
      selected: false
      source: '1753673197346'
      sourceHandle: source
      target: '1753673132811'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: template-transform
      id: 1753673132811-source-17536732746160-target
      selected: false
      source: '1753673132811'
      sourceHandle: source
      target: '17536732746160'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: code
      id: 1753346134162-source-1753759688876-target
      selected: false
      source: '1753346134162'
      sourceHandle: source
      target: '1753759688876'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: code
        targetType: template-transform
      id: 1753759688876-source-17533461952642-target
      selected: false
      source: '1753759688876'
      sourceHandle: source
      target: '17533461952642'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: code
      id: 1753339886438-source-1753342022306-target
      selected: false
      source: '1753339886438'
      sourceHandle: source
      target: '1753342022306'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: end
      id: 17536732746160-source-1754286021242-target
      source: '17536732746160'
      sourceHandle: source
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: end
      id: 17536724676350-source-1754286021242-target
      source: '17536724676350'
      sourceHandle: source
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: end
      id: 17536688996950-source-1754286021242-target
      source: '17536688996950'
      sourceHandle: source
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: end
      id: 1753342707768-source-1754286021242-target
      source: '1753342707768'
      sourceHandle: source
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: end
      id: 17533461952645-source-1754286021242-target
      source: '17533461952645'
      sourceHandle: source
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: end
      id: 1753339672847-false-1754286021242-target
      source: '1753339672847'
      sourceHandle: 'false'
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: end
      id: 17533396760860-false-1754286021242-target
      source: '17533396760860'
      sourceHandle: 'false'
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: end
      id: 17533396767300-false-1754286021242-target
      source: '17533396767300'
      sourceHandle: 'false'
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: end
      id: 17533396773730-false-1754286021242-target
      source: '17533396773730'
      sourceHandle: 'false'
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: end
      id: 1753341814322-false-1754286021242-target
      source: '1753341814322'
      sourceHandle: 'false'
      target: '1754286021242'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: topic
          max_length: 192
          options: []
          required: true
          type: text-input
          variable: topic
        - label: level
          max_length: 48
          options:
          - '1'
          - '2'
          - '3'
          - '4'
          - '5'
          - '6'
          required: true
          type: select
          variable: level
        - label: num_questions_type_10
          max_length: 48
          options: []
          required: true
          type: number
          variable: num_questions_type_10
        - label: num_questions_type_11
          max_length: 48
          options: []
          required: true
          type: number
          variable: num_questions_type_11
        - label: num_questions_type_12
          max_length: 48
          options: []
          required: true
          type: number
          variable: num_questions_type_12
        - label: num_questions_type_13
          max_length: 48
          options: []
          required: true
          type: number
          variable: num_questions_type_13
        - label: num_questions_type_14
          max_length: 48
          options: []
          required: true
          type: number
          variable: num_questions_type_14
        - label: cid
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: cid
      height: 272
      id: '1753336166559'
      position:
        x: 69.07888662360529
        y: 414.6135195705076
      positionAbsolute:
        x: 69.07888662360529
        y: 414.6135195705076
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: '>'
            id: 414ba01c-3fbe-4da1-906c-1389e899a22f
            value: '0'
            varType: number
            variable_selector:
            - '1753336166559'
            - num_questions_type_10
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: éŸ³é¢‘é…å¯¹
        type: if-else
      height: 126
      id: '1753339672847'
      position:
        x: 488
        y: -15.646998365909838
      positionAbsolute:
        x: 488
        y: -15.646998365909838
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: '>'
            id: 1872f4d0-aa6e-4f8b-af68-7aebe87f4db1
            value: '0'
            varType: number
            variable_selector:
            - '1753336166559'
            - num_questions_type_11
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: å¯¹è¯ç†è§£
        type: if-else
      height: 126
      id: '17533396760860'
      position:
        x: 488
        y: 266
      positionAbsolute:
        x: 488
        y: 266
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: '>'
            id: 407e9a9e-7142-4bf4-a41e-d998e9043347
            value: '0'
            varType: number
            variable_selector:
            - '1753336166559'
            - num_questions_type_12
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: å¬éŸ³é‡ç»„
        type: if-else
      height: 126
      id: '17533396767300'
      position:
        x: 488
        y: 563.5681117423045
      positionAbsolute:
        x: 488
        y: 563.5681117423045
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: '>'
            id: bc82919e-2ca1-4bd8-bc69-a9fc2abc07ba
            value: '0'
            varType: number
            variable_selector:
            - '1753336166559'
            - num_questions_type_13
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: é€‰æ‹©åº”ç­”
        type: if-else
      height: 126
      id: '17533396773730'
      position:
        x: 488
        y: 853.4182911836281
      positionAbsolute:
        x: 488
        y: 853.4182911836281
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: 243c4091-01b6-4227-af77-b4db7ec9f1b0
          role: system
          text: "# è§’è‰²\næ‚¨æ˜¯ä¸€ä½ç²¾é€šä¸­è‹±åŒè¯­çš„å„¿ç«¥è‹±è¯­æ•™å­¦ä¸“å®¶ï¼Œå°¤å…¶æ“…é•¿ä¸º3-12å²çš„å­©å­è®¾è®¡äº’åŠ¨å¼å¯¹è¯å­¦ä¹ åœºæ™¯ã€‚\n\n# ä»»åŠ¡\nè¯·æ ¹æ®ç”¨æˆ·è¾“å…¥çš„\
            \ **è¯é¢˜ ({{{{#1753336166559.topic#}}}})**ã€**è‹±è¯­æ°´å¹³ ({{{{#1753336166559.level#}}}})**\
            \ å’Œ **ç”Ÿæˆæ•°é‡ ({{{{#1753336166559.num_questions_type_13#}}}})**ï¼Œåˆ›ä½œå‡ºæŒ‡å®šæ•°é‡çš„ã€å®Œæ•´çš„ç®€çŸ­è‹±è¯­å¯¹è¯åœºæ™¯ã€‚\n\
            \n# åœºæ™¯è¦æ±‚\næ¯ä¸ªåœºæ™¯å¿…é¡»åŒ…å«ï¼š\n1.  **å¯¹è¯å†…å®¹ (dialogue_turns)**ï¼šä¸€ä¸ªåŒ…å«å¤šè½®å¯¹è¯çš„åˆ—è¡¨ï¼Œæ¯è½®å¯¹è¯éœ€æŒ‡æ˜è¯´è¯äººï¼ˆä¾‹å¦‚\
            \ \"Speaker A\", \"Speaker B\"ï¼‰å’Œå¯¹è¯å†…å®¹ã€‚\n2.  **æ­£ç¡®å›å¤ (correct_option)**ï¼šé’ˆå¯¹å¯¹è¯æƒ…æ™¯ï¼Œå­¦ä¹ è€…åº”è¯¥åšå‡ºçš„å”¯ä¸€æ­£ç¡®å›ç­”ã€‚\n\
            3.  **å¹²æ‰°é¡¹ (distractor_options)**ï¼šæä¾›ä¸€ä¸ªç¬¦åˆè¯­å¢ƒä½†é€»è¾‘ä¸æ­£ç¡®çš„å¹²æ‰°é€‰é¡¹ã€‚\n4.  **å¯¹äºè‹±è¯­æ°´å¹³ï¼ˆlevelï¼‰çš„å®šä¹‰**ï¼š\n\
            \  - Level 1ï¼šèƒ½ç†è§£å¸¸è§è¯æ±‡ä¸åŸºæœ¬æŒ‡ä»¤\n  - Level 2ï¼šèƒ½è¿›è¡Œé—®å€™ã€è‡ªæˆ‘ä»‹ç»ã€è¡¨è¾¾å–œå¥½\n  - Level 3ï¼šå¯ç”¨å®Œæ•´å¥å‹æè¿°æ—¥å¸¸æƒ…å¢ƒ\n\
            \  - Level 4ï¼šèƒ½å›´ç»•ç†Ÿæ‚‰è¯é¢˜è¿›è¡Œè¿è´¯è¡¨è¾¾\n  - Level 5ï¼šè¡¨è¾¾è¾ƒä¸ºæµç•…ï¼Œèƒ½è¡¨è¾¾è§‚ç‚¹å’Œç†è§£ä¸€èˆ¬æ–‡æœ¬\n  - Level\
            \ 6ï¼šèƒ½è¿›è¡Œæ—¥å¸¸äº¤æµä¸åŸºç¡€ä¹¦é¢è¡¨è¾¾\n\n# å¼ºåˆ¶è§„åˆ™ï¼ˆMANDATORY RULESï¼‰\n- å¯¹è¯å†…å®¹ï¼ˆ`line`å­—æ®µï¼‰**å¿…é¡»**æ˜¯åŒ…å«è‡³å°‘3ä¸ªå•è¯çš„ã€æœ‰æ„ä¹‰çš„è‹±æ–‡å¥å­ã€‚\n\
            - **ä¸¥ç¦ï¼ˆSTRICTLY FORBIDDENï¼‰** åœ¨`line`å­—æ®µä¸­è¾“å‡ºç©ºå­—ç¬¦ä¸²ï¼ˆ\"\"ï¼‰æˆ–æ— æ„ä¹‰çš„å ä½ç¬¦ã€‚\n- ä¸¥æ ¼æŒ‰ç…§ä¸‹é¢ç¤ºä¾‹çš„JSONæ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„è§£é‡Šã€‚\n\
            \n# è¾“å‡ºæ ¼å¼\nè¯·è¾“å‡ºä¸€ä¸ªæ ‡å‡† JSON å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º `scenarios` çš„æ•°ç»„ã€‚\n\n## ç¤ºä¾‹è¾“å‡º (è¾“å…¥: topic=\"\
            æ‰“è½¦\", level=\"Level 3\", card_quantity=1)\n{\n  \"scenarios\": [\n   \
            \ {\n      \"dialogue_turns\": [\n        {\n          \"speaker\": \"\
            Child\",\n          \"line\": \"Mom, how do we get a taxi?\"\n       \
            \ },\n        {\n          \"speaker\": \"Mother\",\n          \"line\"\
            : \"We can call one or just wave our hand.\"\n        }\n      ],\n  \
            \    \"correct_option\": \"Let's wave our hand!\",\n      \"distractor_options\"\
            : [\n        \"Let's go home.\"\n      ]\n    }\n  ]\n}"
        selected: false
        title: å¯¹è¯åœºæ™¯ç”Ÿæˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1753339886438'
      position:
        x: 902.0493841724706
        y: 884.803049107735
      positionAbsolute:
        x: 902.0493841724706
        y: 884.803049107735
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: '>'
            id: 792c5c34-f1ed-4af2-86df-563810707f6d
            value: '0'
            varType: number
            variable_selector:
            - '1753336166559'
            - num_questions_type_14
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: å£è¯­åº”ç­”
        type: if-else
      height: 126
      id: '1753341814322'
      position:
        x: 488
        y: 1122.5324415614411
      positionAbsolute:
        x: 488
        y: 1122.5324415614411
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import random\nimport time\nimport json\n\ndef main(llm_string_output:\
          \ str) -> dict:\n    processed_scenarios = []\n    \n    # 1. ç›´æ¥è§£ææ¥è‡ªLLMèŠ‚ç‚¹çš„åŸå§‹å­—ç¬¦ä¸²è¾“å‡º\n\
          \    try:\n        data = json.loads(llm_string_output)\n        scenarios_list\
          \ = data.get(\"scenarios\", [])\n    except json.JSONDecodeError:\n    \
          \    return {\"error\": f\"Input string is not a valid JSON. Content: {llm_string_output}\"\
          , \"processed_scenarios\": []}\n\n    if not scenarios_list:\n        return\
          \ {\"error\": \"No scenarios found in the parsed JSON.\", \"processed_scenarios\"\
          : []}\n\n    # 2. å¾ªç¯å¤„ç†æ¯ä¸€ä¸ªåœºæ™¯\n    for scenario in scenarios_list:\n     \
          \   try:\n            # 2a. å°†å¯¹è¯å†…å®¹å¤„ç†æˆæ–°çš„ question åˆ—è¡¨æ ¼å¼\n            dialogue_turns\
          \ = scenario.get(\"dialogue_turns\", [])\n            formatted_question_list\
          \ = []\n            speaker_map = {}\n            for i, turn in enumerate(dialogue_turns):\n\
          \                speaker = turn.get(\"speaker\")\n                if speaker\
          \ not in speaker_map:\n                    role = \"left_girl\" if len(speaker_map)\
          \ % 2 == 0 else \"right_girl\"\n                    speaker_map[speaker]\
          \ = role\n\n                formatted_question_list.append({\n         \
          \           \"role\": speaker_map[speaker],\n                    \"type\"\
          : \"eng_cn_audio\",\n                    \"eng\": turn.get(\"line\", \"\"\
          ),\n                    \"audio_url\": True\n                })\n      \
          \      \n            # 2b. å¤„ç†é€‰æ‹©é¢˜é€‰é¡¹ï¼ˆæ··åˆã€æ‰“ä¹±ã€åˆ†é…Keyï¼‰\n            correct_text\
          \ = scenario.get(\"correct_option\") # æ³¨æ„ï¼šè¿™é‡Œç”¨çš„æ˜¯ correct_optionï¼Œä¸æ˜¯ä¸­æ–‡\n  \
          \          distractor_options_text = scenario.get(\"distractor_options\"\
          , [])\n            all_options_text = [correct_text] + distractor_options_text\n\
          \            random.shuffle(all_options_text)\n            \n          \
          \  final_options = []\n            answer_key = \"\"\n            for i,\
          \ text in enumerate(all_options_text):\n                key = chr(65 + i)\n\
          \                option_data = {\"key\": key, \"type\": \"text\", \"text\"\
          : text}\n                final_options.append(option_data)\n           \
          \     if text == correct_text:\n                    answer_key = key\n \
          \           \n            # 2c. æ‰“åŒ…æˆæœ€ç»ˆçš„â€œåŠæˆå“â€æ•°æ®\n            processed_scenario\
          \ = {\n                \"question_turns\": formatted_question_list,\n  \
          \              \"dialogue_turns_text_only\": dialogue_turns,\n         \
          \       \"question_for_user\": scenario.get(\"question_for_user\", \"é€‰æ‹©åˆé€‚çš„å›å¤\"\
          ),\n                \"answer_key\": answer_key,\n                \"options\"\
          : final_options\n            }\n            processed_scenarios.append(processed_scenario)\n\
          \n        except Exception as e:\n            print(f\"Error processing\
          \ a scenario: {e}\")\n            continue\n            \n    return {\"\
          processed_scenarios\": processed_scenarios}"
        code_language: python3
        desc: ''
        outputs:
          processed_scenarios:
            children: null
            type: array[object]
        selected: false
        title: é€‰é¡¹å¤„ç†ä¸é‡ç»„
        type: code
        variables:
        - value_selector:
          - '1753339886438'
          - text
          variable: llm_string_output
      height: 54
      id: '1753342022306'
      position:
        x: 1328.8658129030878
        y: 884.803049107735
      positionAbsolute:
        x: 1328.8658129030878
        y: 884.803049107735
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: "{% for scenario in processed_scenarios %}\n{\n    \"template\"\
          : \"t000010\",\n    \"remark\": \"é€‰æ‹©åº”ç­”\",\n    \"type\":\"J\",\n    \"topic_id\"\
          :\"{{ cid }}\",\n    \"topic\":\"{{ topic }}\",\n    \"level\":\"{{ level\
          \ }}\",\n    \"vocabulary_group\":\"A\",\n    \"question\": [\n        {#\
          \ æ–°å¢çš„å¾ªç¯ï¼Œç”¨äºç”Ÿæˆæ¯ä¸€å¥å¯¹è¯ #}\n        {% for turn in scenario['question_turns']\
          \ %}\n        {\n            \"role\": \"{{ turn['role'] }}\",\n       \
          \     \"type\": \"eng_cn_audio\",\n            \"eng\": \"{{ turn['eng']\
          \ | e }}\",\n            \"audio_url\": true\n        }{% if not loop.last\
          \ %},{% endif %}\n        {% endfor %}\n    ],\n    \"title\": \"{{ scenario['question_for_user']\
          \ | default('é€‰æ‹©åˆé€‚çš„å›å¤', true) }}\", \n    \"title_position\": 2, \n    \"\
          answer_type\": \"text\", \n    \"answer\": \"{{ scenario['answer_key'] }}\"\
          , \n    \"answer_input\": \"radio\", \n    \"options\": [\n        {% for\
          \ option in scenario['options'] %}\n        {\n            \"key\": \"{{\
          \ option['key'] }}\",\n            \"type\": \"text\",\n            \"text\"\
          : \"{{ option['text'] | e }}\"\n        }{% if not loop.last %},{% endif\
          \ %}\n        {% endfor %}\n    ]\n}\n{% if not loop.last %},{% endif %}\n\
          {% endfor %}"
        title: ç”Ÿæˆæœ€ç»ˆJSON 4
        type: template-transform
        variables:
        - value_selector:
          - '1753342022306'
          - processed_scenarios
          variable: processed_scenarios
        - value_selector:
          - '1753336166559'
          - topic
          value_type: string
          variable: topic
        - value_selector:
          - '1753336166559'
          - level
          value_type: string
          variable: level
        - value_selector:
          - '1753336166559'
          - cid
          value_type: string
          variable: cid
      height: 54
      id: '1753342086794'
      position:
        x: 1667.8211984834427
        y: 884.5104374650145
      positionAbsolute:
        x: 1667.8211984834427
        y: 884.5104374650145
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: 1072fafb-9760-4a13-854b-0b9c4bb99339
          role: system
          text: "# è§’è‰²\næ‚¨æ˜¯ä¸€åä¸“ä¸šçš„AIåº”ç”¨JSONæ ¼å¼æ ¡éªŒä¸“å®¶ã€‚\n\n# ä»»åŠ¡\nè¯·å¯¹è¾“å…¥çš„JSONæ•°æ® ({{{{#1753342086794.output#}}}})\
            \ è¿›è¡Œä¸¥æ ¼çš„ç»“æ„å’Œé€»è¾‘æ ¡éªŒã€‚\n\n# æ ¡éªŒè§„åˆ™\n1.  **é¡¶çº§å­—æ®µ**: å¿…é¡»å­˜åœ¨ `template`, `remark`, `question`,\
            \ `title`, `answer`, `options`ã€‚\n2.  **question æ•°ç»„**:\n    - å¿…é¡»æ˜¯åŒ…å«ä¸€ä¸ªå¯¹è±¡çš„æ•°ç»„ã€‚\n\
            \    - å¯¹è±¡å†…å¿…é¡»åŒ…å« `conversation_id`(éç©ºå­—ç¬¦ä¸²), `audio_start`(å­—ç¬¦ä¸²), `audio_end`(å­—ç¬¦ä¸²),\
            \ `message_start`(å­—ç¬¦ä¸²), `message_end`(å­—ç¬¦ä¸²), `show_conversation_text`(\"\
            True\"æˆ–\"False\"å­—ç¬¦ä¸²)ã€‚\n3.  **answer å­—æ®µ**:\n    - `answer` çš„å€¼ï¼ˆå¦‚ \"A\"ï¼‰å¿…é¡»æ˜¯\
            \ `options` æ•°ç»„ä¸­æŸä¸ªå…ƒç´ çš„ `key` å€¼ã€‚\n4.  **options æ•°ç»„**:\n    - å¿…é¡»æ˜¯ä¸€ä¸ªéç©ºæ•°ç»„ã€‚\n\
            \    - æ¯ä¸ªå…ƒç´ å¿…é¡»åŒ…å« `key`(å¤§å†™å­—æ¯å­—ç¬¦ä¸²) å’Œ `text`(éç©ºå­—ç¬¦ä¸²)ã€‚\n    - `key` çš„å€¼åœ¨æ•°ç»„å†…å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚\n\
            \n# è¾“å‡ºè¦æ±‚\nè¿”å›æ ‡å‡†JSONæ ¼å¼ç»“æœï¼ŒåŒ…å« `is_valid` (bool) å’Œ `error_details` (array)ã€‚å¦‚æœæ— æ•ˆï¼Œè¯·åœ¨\
            \ `error_details` ä¸­è¯¦ç»†è¯´æ˜ä¸ç¬¦åˆè§„åˆ™çš„åœ°æ–¹ã€‚"
        selected: false
        title: é¢˜ç›®å‡†ç¡®æ€§æ ¡éªŒ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1753342493873'
      position:
        x: 2009.2604710189908
        y: 884.803049107735
      positionAbsolute:
        x: 2009.2604710189908
        y: 884.803049107735
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: "{% for scenario in processed_scenarios %}\n## â å¡ç‰‡å®¡æ ¸æ¸…å• (å¯¹è¯é€‰æ‹©)\n\
          \n---\n\n### **1. åŸºæœ¬ä¿¡æ¯**\n\n- **å¯¹è¯ID**: `{{ scenario.conversation_id }}`\n\
          - **æ¨¡æ¿ç±»å‹**: `t000010` (é€‰æ‹©åº”ç­”)\n\n### **2. å¯¹è¯å†…å®¹é¢„è§ˆ**\n\n{# ä½¿ç”¨æ–¹æ‹¬å· ['line'] æ¥æ›¿ä»£\
          \ .line #}\n{% for turn in scenario.dialogue_turns_text_only %}\n- **{{\
          \ turn['speaker'] }}**: {{ turn['line'] }}\n{% endfor %}\n\n### **3. ç”¨æˆ·ä»»åŠ¡ä¸é€‰é¡¹**\n\
          \n- **ä»»åŠ¡æ ‡é¢˜**: é€‰æ‹©åˆé€‚çš„å›å¤\n- **é€‰é¡¹åˆ—è¡¨**:\n{# ä¸ºä¿æŒé£æ ¼ç»Ÿä¸€ï¼Œè¿™é‡Œä¹Ÿä½¿ç”¨æ–¹æ‹¬å· #}\n{% for option\
          \ in scenario.options %}\n  - **[{{ option['key'] }}]**: {{ option['text']\
          \ }}{% if option['key'] == scenario.answer_key %}  **<-- âœ… æ­£ç¡®ç­”æ¡ˆ**{% endif\
          \ %}\n{% endfor %}\n\n### **4. ç³»ç»Ÿåˆ¤å®š**\n- **æ­£ç¡®ç­”æ¡ˆKey**: `{{ scenario.answer_key\
          \ }}`\n\n{% if not loop.last %}\n\n========================================\n\
          \n{% endif %}\n{% endfor %}"
        title: äººå·¥å®¡æ ¸æ ¼å¼è½¬æ¢-13
        type: template-transform
        variables:
        - value_selector:
          - '1753342022306'
          - processed_scenarios
          variable: processed_scenarios
      height: 54
      id: '1753342707768'
      position:
        x: 2328.156505206653
        y: 884.803049107735
      positionAbsolute:
        x: 2328.156505206653
        y: 884.803049107735
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: 62e3ca54-85dc-46e1-9386-1e5ea025fc45
          role: system
          text: "# è§’è‰²\næ‚¨æ˜¯ä¸€ä½é¡¶çº§çš„å„¿ç«¥è‹±è¯­æ•™å­¦å†…å®¹è®¾è®¡å¸ˆï¼Œä¸“æ³¨äºåˆ›è®¾èƒ½æ¿€å‘å­©å­å¼€å£è¯´è¯çš„æ²‰æµ¸å¼å¯¹è¯åœºæ™¯ã€‚\n\n# ä»»åŠ¡\nè¯·æ ¹æ®ç”¨æˆ·è¾“å…¥çš„\
            \ **è¯é¢˜ ({{{{#1753336166559.topic#}}}})**ã€**è‹±è¯­æ°´å¹³ ({{{{#1753336166559.level#}}}})**\
            \ å’Œ **ç”Ÿæˆæ•°é‡ ({{{{#1753336166559.num_questions_type_14#}}}})**ï¼Œåˆ›ä½œå‡ºæŒ‡å®šæ•°é‡çš„è‹±è¯­å¯¹è¯åœºæ™¯ã€‚æ¯ä¸ªåœºæ™¯çš„ç»“å°¾éƒ½éœ€è¦ç”¨æˆ·æ ¹æ®ä¸€ä¸ªä¸­æ–‡æç¤ºï¼Œè¯´å‡ºå¯¹åº”çš„è‹±æ–‡å¥å­ã€‚\n\
            \n# åœºæ™¯è¦æ±‚\næ¯ä¸ªåœºæ™¯å¿…é¡»åŒ…å«ï¼š\n1.  **å¯¹è¯å†…å®¹ (dialogue_turns)**ï¼šä¸€ä¸ªå¼•äººå…¥èƒœçš„å¤šè½®å¯¹è¯åˆ—è¡¨ã€‚\n2.\
            \  **ç”¨æˆ·æç¤ºå¥ (prompt_for_user_cn)**ï¼šä¸€å¥ä¸­æ–‡æç¤ºï¼Œè¿™æ˜¯ç”¨æˆ·éœ€è¦ç¿»è¯‘å¹¶ç”¨è‹±è¯­è¯´å‡ºæ¥çš„å†…å®¹ã€‚æ­¤å¥å¿…é¡»ä¸å‰é¢çš„å¯¹è¯å†…å®¹åœ¨é€»è¾‘ä¸Šè¿è´¯ã€‚\n\
            3.  **æ ‡å‡†è‹±æ–‡ç­”æ¡ˆ (correct_answer_en)**ï¼š`prompt_for_user_cn`çš„å‡†ç¡®ã€åœ°é“çš„è‹±æ–‡ç¿»è¯‘ã€‚è¿™å°†ä½œä¸ºè¯­éŸ³è¯„æµ‹çš„å‚è€ƒæ ‡å‡†ã€‚\n\
            4.  **å¯¹äºè‹±è¯­æ°´å¹³ï¼ˆlevelï¼‰çš„å®šä¹‰**ï¼š\n  - Level 1ï¼šèƒ½ç†è§£å¸¸è§è¯æ±‡ä¸åŸºæœ¬æŒ‡ä»¤\n  - Level 2ï¼šèƒ½è¿›è¡Œé—®å€™ã€è‡ªæˆ‘ä»‹ç»ã€è¡¨è¾¾å–œå¥½\n\
            \  - Level 3ï¼šå¯ç”¨å®Œæ•´å¥å‹æè¿°æ—¥å¸¸æƒ…å¢ƒ\n  - Level 4ï¼šèƒ½å›´ç»•ç†Ÿæ‚‰è¯é¢˜è¿›è¡Œè¿è´¯è¡¨è¾¾\n  - Level 5ï¼šè¡¨è¾¾è¾ƒä¸ºæµç•…ï¼Œèƒ½è¡¨è¾¾è§‚ç‚¹å’Œç†è§£ä¸€èˆ¬æ–‡æœ¬\n\
            \  - Level 6ï¼šèƒ½è¿›è¡Œæ—¥å¸¸äº¤æµä¸åŸºç¡€ä¹¦é¢è¡¨è¾¾\n\n# å¼ºåˆ¶è§„åˆ™ï¼ˆMANDATORY RULES - NON-NEGOTIABLEï¼‰\n\
            -   `dialogue_turns`ä¸­çš„`line`å­—æ®µ**å¿…é¡»**æ˜¯å†…å®¹å®Œæ•´ã€æœ‰æ„ä¹‰çš„å¥å­ï¼Œ**ä¸¥ç¦ä¸ºç©º**ã€‚\n-   `prompt_for_user_cn`å­—æ®µ**å¿…é¡»**æ˜¯ä¸€å¥å®Œæ•´çš„ä¸­æ–‡å¥å­ï¼Œ**ä¸¥ç¦ä¸ºç©º**ã€‚\n\
            -   `correct_answer_en`å­—æ®µ**å¿…é¡»**æ˜¯ä¸€å¥å®Œæ•´çš„è‹±æ–‡å¥å­ï¼Œ**ä¸¥ç¦ä¸ºç©º**ã€‚\n-   `correct_answer_en`**å¿…é¡»**æ˜¯`prompt_for_user_cn`çš„ç²¾å‡†ç¿»è¯‘ã€‚\n\
            -   **å¿…é¡»**ä¸¥æ ¼æŒ‰ç…§ä¸‹é¢ç¤ºä¾‹çš„JSONæ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„è§£é‡Šæˆ–æ–‡å­—ã€‚\n\n# è¾“å‡ºæ ¼å¼\nè¯·è¾“å‡ºä¸€ä¸ªæ ‡å‡† JSON å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º\
            \ `scenarios` çš„æ•°ç»„ã€‚\n\n## ç¤ºä¾‹è¾“å‡º (è¾“å…¥: topic=\"æ‰“è½¦\", level=\"Level 3\", card_quantity=1)\n\
            {\n  \"scenarios\": [\n    {\n      \"dialogue_turns\": [\n        {\n\
            \          \"speaker\": \"Passenger\",\n          \"line\": \"What color\
            \ is the cab coming in this way?\"\n        },\n        {\n          \"\
            speaker\": \"Passenger\",\n          \"line\": \"I said what is the color\
            \ of your cab?\"\n        }\n      ],\n      \"prompt_for_user_cn\": \"\
            æˆ‘çš„å‡ºç§Ÿè½¦æ˜¯é»„è‰²çš„ã€‚\",\n      \"correct_answer_en\": \"My cab is yellow.\"\n  \
            \  }\n  ]\n}"
        selected: false
        title: å£è¯­åœºæ™¯ç”Ÿæˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1753346134162'
      position:
        x: 902.0493841724706
        y: 1154.2996047244285
      positionAbsolute:
        x: 902.0493841724706
        y: 1154.2996047244285
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: "{% for scenario in processed_scenarios %}\n{\n    \"template\"\
          : \"t000011\",\n    \"remark\": \"é€‰æ‹©åº”ç­”\",\n    \"type\":\"K\",\n    \"topic_id\"\
          :\"{{ cid }}\",\n    \"topic\":\"{{ topic }}\",\n    \"level\":\"{{ level\
          \ }}\",\n    \"vocabulary_group\":\"A\",\n    \"question\": [\n        {#\
          \ æ–°å¢çš„å¾ªç¯ï¼Œç”¨äºç”Ÿæˆæ¯ä¸€å¥å¯¹è¯ #}\n        {% for turn in scenario['question_turns']\
          \ %}\n        {\n            \"role\": \"{{ turn['role'] }}\",\n       \
          \     \"type\": \"eng_cn_audio\",\n            \"eng\": \"{{ turn['eng']\
          \ | e }}\",\n            \"audio_url\": true\n        }{% if not loop.last\
          \ %},{% endif %}\n        {% endfor %}\n    ],\n    \"title\": \"å°è¯•å›ç­”ï¼š{{\
          \ scenario['prompt_for_user_cn'] }}\",\n    \"title_position\": 2,\n   \
          \ \"answer_type\": \"text\",\n    \"answer\": \"{{ scenario['correct_answer_en']\
          \ | e }}\",\n    \"answer_input\": \"record\",\n    \"options\": []\n}\n\
          {% if not loop.last %},{% endif %}\n{% endfor %}"
        title: ç”Ÿæˆæœ€ç»ˆJSON 5
        type: template-transform
        variables:
        - value_selector:
          - '1753759688876'
          - processed_scenarios
          variable: processed_scenarios
        - value_selector:
          - '1753336166559'
          - topic
          value_type: string
          variable: topic
        - value_selector:
          - '1753336166559'
          - level
          value_type: string
          variable: level
        - value_selector:
          - '1753336166559'
          - cid
          value_type: string
          variable: cid
      height: 54
      id: '17533461952642'
      position:
        x: 1667.8211984834427
        y: 1154.2996047244285
      positionAbsolute:
        x: 1667.8211984834427
        y: 1154.2996047244285
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{% for scenario in processed_scenarios %}

          ## â å¡ç‰‡å®¡æ ¸æ¸…å• (å£è¯­åº”ç­”)


          ---


          ### **1. åŸºæœ¬ä¿¡æ¯**


          - **å¯¹è¯ID**: `{{ scenario[''conversation_id''] }}`

          - **æ¨¡æ¿ç±»å‹**: `t000011` (å£è¯­åº”ç­”)


          ### **2. å¯¹è¯å†…å®¹é¢„è§ˆ**


          {% for turn in scenario[''dialogue_turns_text_only''] %}

          - **{{ turn[''speaker''] }}**: {{ turn[''line''] }}

          {% endfor %}


          ### **3. ç”¨æˆ·å£è¯­ä»»åŠ¡**


          - **ä»»åŠ¡æç¤º (ä¸­æ–‡)**: {{ scenario[''prompt_for_user_cn''] }}

          - **æ ‡å‡†ç­”æ¡ˆ (è‹±æ–‡)**: {{ scenario[''correct_answer_en''] }}


          ### **4. æ ¡éªŒè¦ç‚¹**

          - [ ] ä¸­æ–‡æç¤ºä¸è‹±æ–‡ç­”æ¡ˆæ˜¯å¦äº’ä¸ºç²¾å‡†ç¿»è¯‘ï¼Ÿ

          - [ ] ä»»åŠ¡æç¤ºæ˜¯å¦ä¸ä¸Šæ–¹å¯¹è¯æƒ…æ™¯é€»è¾‘è¿è´¯ï¼Ÿ

          - [ ] è‹±æ–‡ç­”æ¡ˆçš„éš¾åº¦æ˜¯å¦ç¬¦åˆè®¾å®šçš„è¯­è¨€ç­‰çº§ï¼Ÿ


          {% if not loop.last %}


          ========================================


          {% endif %}

          {% endfor %}'
        title: äººå·¥å®¡æ ¸æ ¼å¼è½¬æ¢-14
        type: template-transform
        variables:
        - value_selector:
          - '1753759688876'
          - processed_scenarios
          variable: processed_scenarios
      height: 54
      id: '17533461952645'
      position:
        x: 2328.156505206653
        y: 1154.2996047244285
      positionAbsolute:
        x: 2328.156505206653
        y: 1154.2996047244285
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: c11b7fe6-fa1a-415b-98bc-ab62110ee26c
          role: system
          text: "# è§’è‰²\næ‚¨æ˜¯ä¸€ä½æå…¶ä¸¥è°¨çš„AIæ•™ç ”å†…å®¹è´¨æ£€ä¸“å®¶ï¼Œè´Ÿè´£å¯¹JSONæ ¼å¼çš„â€œå£è¯­åº”ç­”â€é¢˜å¡æ•°æ®è¿›è¡Œè‡ªåŠ¨åŒ–è´¨é‡å®¡æ ¸ã€‚\n\n# ä»»åŠ¡\n\
            è¯·å¯¹ä»¥ä¸‹è¾“å…¥çš„JSONæ•°æ® ({{{{#17533461952642.output#}}}}) è¿›è¡Œä¸¥æ ¼çš„ã€é€é¡¹çš„æ ¡éªŒã€‚\n\n# æ ¸å¿ƒæ ¡éªŒè§„åˆ™\
            \ (å¿…é¡»ä¸¥æ ¼éµå®ˆ)\n\n1.  **å­—æ®µå®Œæ•´æ€§**:\n    -   æ£€æŸ¥ `template`, `remark`, `question`,\
            \ `title`, `answer`, `answer_input`, `options` è¿™äº›é¡¶çº§å­—æ®µæ˜¯å¦éƒ½å­˜åœ¨ã€‚\n\n2.  **å†…å®¹ä¸æ ¼å¼**:\n\
            \    -   `template` å­—æ®µçš„å€¼**å¿…é¡»**æ˜¯ `\"t000011\"`ã€‚\n    -   `title` å­—æ®µçš„å†…å®¹**å¿…é¡»**ä»¥`\"\
            å°è¯•å›ç­”ï¼š\"`å¼€å¤´ï¼Œä¸”å†’å·åå¿…é¡»æœ‰éç©ºçš„ä¸­æ–‡å†…å®¹ã€‚\n    -   `answer` å­—æ®µçš„å†…å®¹**å¿…é¡»**æ˜¯ä¸€ä¸ªéç©ºçš„ã€å®Œæ•´çš„è‹±æ–‡å¥å­ã€‚\n\
            \    -   `options` å­—æ®µ**å¿…é¡»**æ˜¯ä¸€ä¸ª**ç©ºæ•°ç»„** `[]`ã€‚\n    -   `answer_input` å­—æ®µçš„å€¼**å¿…é¡»**æ˜¯\
            \ `\"voice\"`ã€‚\n\n3.  **é€»è¾‘ä¸€è‡´æ€§ (æœ€é‡è¦)**:\n    -   **ç¿»è¯‘å‡†ç¡®æ€§**: `answer`å­—æ®µä¸­çš„è‹±æ–‡å¥å­ï¼Œæ˜¯å¦æ˜¯`title`å­—æ®µä¸­ä¸­æ–‡æç¤ºçš„å‡†ç¡®ã€åœ°é“ã€æ— è¯¯çš„ç¿»è¯‘ï¼Ÿè¯·è¿›è¡Œä¸­è‹±æ–‡æ¯”å¯¹åˆ¤æ–­ã€‚\n\
            \n# è¾“å‡ºè¦æ±‚\nè¿”å›æ ‡å‡†JSONæ ¼å¼çš„ç»“æœã€‚å¦‚æœæ‰€æœ‰æ ¡éªŒé€šè¿‡ï¼Œ`is_valid`ä¸º`true`ã€‚è‹¥æœ‰ä»»ä½•ä¸€æ¡è§„åˆ™ä¸æ»¡è¶³ï¼Œ`is_valid`ä¸º`false`ï¼Œå¹¶åœ¨`error_details`ä¸­è¯¦ç»†è¯´æ˜é—®é¢˜ã€‚\n\
            \n{\n    \"is_valid\": bool,\n    \"error_details\": [\n        {\n  \
            \          \"field\": \"å­—æ®µè·¯å¾„ (e.g., title)\",\n            \"issue_type\"\
            : \"MISSING_FIELD | INVALID_CONTENT | INCONSISTENT_LOGIC\",\n        \
            \    \"description\": \"å…·ä½“é—®é¢˜æè¿°ã€‚ä¾‹å¦‚ï¼š'answerå­—æ®µçš„è‹±æ–‡ç¿»è¯‘ä¸titleå­—æ®µçš„ä¸­æ–‡æç¤ºä¸åŒ¹é…ã€‚'\",\n\
            \            \"suggestion\": \"ä¿®å¤å»ºè®®ï¼ˆå¯é€‰ï¼‰\"\n        }\n    ],\n    \"validated_data\"\
            : {}  // ä»…åœ¨ is_valid ä¸º true æ—¶ï¼Œè¿”å›åŸå§‹çš„ã€é€šè¿‡æ ¡éªŒçš„æ•°æ®\n}"
        selected: false
        title: é¢˜ç›®å‡†ç¡®æ€§æ ¡éªŒ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1753351512925'
      position:
        x: 2009.2604710189908
        y: 1154.2996047244285
      positionAbsolute:
        x: 2009.2604710189908
        y: 1154.2996047244285
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: b8787e38-46f5-48ac-9400-8d0f60106c7d
          role: system
          text: "# è§’è‰²\næ‚¨æ˜¯ä¸€ä½é¡¶çº§çš„å„¿ç«¥è‹±è¯­æ•™å­¦å†…å®¹ä¸“å®¶ï¼Œæ“…é•¿è®¾è®¡å¥å­ç»“æ„è®­ç»ƒä»»åŠ¡ã€‚\n\n# ä»»åŠ¡\nè¯·æ ¹æ®ç”¨æˆ·è¾“å…¥çš„ **è¯é¢˜ ({{{{#1753336166559.topic#}}}})**ã€**è‹±è¯­æ°´å¹³\
            \ ({{{{#1753336166559.level#}}}})** å’Œ **ç”Ÿæˆæ•°é‡ ({{{{#1753336166559.num_questions_type_12#}}}})**ï¼Œåˆ›ä½œå‡ºæŒ‡å®šæ•°é‡çš„ã€åŒ…å«å¤šè½®å¯¹è¯å’Œå¥å­é‡ç»„ä»»åŠ¡çš„åœºæ™¯ã€‚\n\
            \n# åœºæ™¯è¦æ±‚\næ¯ä¸ªåœºæ™¯å¿…é¡»åŒ…å«ï¼š\n1.  **å¯¹è¯å†…å®¹ (dialogue_turns)**ï¼šä¸€ä¸ªå®Œæ•´çš„å¤šè½®å¯¹è¯ã€‚\n2.  **å¾…é‡ç»„çš„å¥å­\
            \ (sentence_to_reorder)**ï¼šä»ä¸Šæ–¹å¯¹è¯ä¸­é€‰å–çš„ä¸€ä¸ªå®Œæ•´çš„ã€é€‚åˆè¿›è¡Œé‡ç»„ç»ƒä¹ çš„å¥å­ã€‚\n3.  **åˆ†è¯è¯å— (reorder_chunks)**ï¼šå°†`sentence_to_reorder`æ‹†åˆ†æˆæœ‰æ„ä¹‰çš„ã€ç”¨äºé‡ç»„çš„è¯æˆ–çŸ­è¯­å—ã€‚**è¿™éå¸¸é‡è¦**ï¼Œè¯·ä¸è¦æŒ‰å•ä¸ªå•è¯æ‹†åˆ†ï¼Œè¦æŠŠæœ‰å›ºå®šæ­é…çš„çŸ­è¯­ï¼ˆå¦‚\
            \ \"the color of\", \"what is\"ï¼‰ä½œä¸ºä¸€ä¸ªæ•´ä½“ã€‚\n4.  **å¯¹äºè‹±è¯­æ°´å¹³ï¼ˆlevelï¼‰çš„å®šä¹‰**ï¼š\n \
            \ - Level 1ï¼šèƒ½ç†è§£å¸¸è§è¯æ±‡ä¸åŸºæœ¬æŒ‡ä»¤\n  - Level 2ï¼šèƒ½è¿›è¡Œé—®å€™ã€è‡ªæˆ‘ä»‹ç»ã€è¡¨è¾¾å–œå¥½\n  - Level 3ï¼šå¯ç”¨å®Œæ•´å¥å‹æè¿°æ—¥å¸¸æƒ…å¢ƒ\n\
            \  - Level 4ï¼šèƒ½å›´ç»•ç†Ÿæ‚‰è¯é¢˜è¿›è¡Œè¿è´¯è¡¨è¾¾\n  - Level 5ï¼šè¡¨è¾¾è¾ƒä¸ºæµç•…ï¼Œèƒ½è¡¨è¾¾è§‚ç‚¹å’Œç†è§£ä¸€èˆ¬æ–‡æœ¬\n  - Level\
            \ 6ï¼šèƒ½è¿›è¡Œæ—¥å¸¸äº¤æµä¸åŸºç¡€ä¹¦é¢è¡¨è¾¾\n\n# å¼ºåˆ¶è§„åˆ™ (MANDATORY RULES)\n-   æ‰€æœ‰`line`ã€`sentence_to_reorder`å­—æ®µä¸¥ç¦ä¸ºç©ºã€‚\n\
            -   `reorder_chunks`æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ æ‹¼æ¥åï¼Œå¿…é¡»èƒ½**ä¸€å­—ä¸å·®åœ°**è¿˜åŸæˆ`sentence_to_reorder`ã€‚\n\
            -   ä¸¥æ ¼æŒ‰ç…§ä¸‹é¢ç¤ºä¾‹çš„JSONæ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„è§£é‡Šã€‚\n\n# è¾“å‡ºæ ¼å¼\nè¯·è¾“å‡ºä¸€ä¸ªæ ‡å‡† JSON å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º\
            \ `scenarios` çš„æ•°ç»„ã€‚\n\n## ç¤ºä¾‹è¾“å‡º (è¾“å…¥: topic=\"æ‰“è½¦\", level=\"Level 3\", card_quantity=1)\n\
            {\n  \"scenarios\": [\n    {\n      \"dialogue_turns\": [\n        {\n\
            \          \"speaker\": \"A\",\n          \"line\": \"What color is the\
            \ cab coming in this way?\"\n        },\n        {\n          \"speaker\"\
            : \"B\",\n          \"line\": \"what?\"\n        }\n      ],\n      \"\
            sentence_to_reorder\": \"I said what is the color of your cab?\",\n  \
            \    \"reorder_chunks\": [\n        \"I said\",\n        \"what is\",\n\
            \        \"the color of\",\n        \"your cab\"\n      ]\n    }\n  ]\n\
            }"
        selected: false
        title: é‡ç»„åœºæ™¯ç”Ÿæˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1753351954442'
      position:
        x: 902.0493841724706
        y: 597.3489695291591
      positionAbsolute:
        x: 902.0493841724706
        y: 597.3489695291591
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import random\nimport time\nimport json\n\ndef main(llm_string_output:\
          \ str) -> dict:\n    processed_scenarios = []\n    \n    try:\n        data\
          \ = json.loads(llm_string_output)\n        scenarios_list = data.get(\"\
          scenarios\", [])\n    except json.JSONDecodeError:\n        return {\"error\"\
          : \"Input string is not valid JSON.\", \"processed_scenarios\": []}\n\n\
          \    if not scenarios_list:\n        return {\"error\": \"No scenarios found\
          \ in the parsed JSON.\", \"processed_scenarios\": []}\n\n    for scenario\
          \ in scenarios_list:\n        try:\n            # --- START: æœ¬æ¬¡ä¸»è¦ä¿®æ”¹åŒºåŸŸ ---\n\
          \            dialogue_turns = scenario.get(\"dialogue_turns\", [])\n   \
          \         formatted_question_list = []\n            speaker_map = {}\n \
          \           for i, turn in enumerate(dialogue_turns):\n                speaker\
          \ = turn.get(\"speaker\")\n                if speaker not in speaker_map:\n\
          \                    role = \"left_girl\" if len(speaker_map) % 2 == 0 else\
          \ \"right_girl\"\n                    speaker_map[speaker] = role\n\n  \
          \              formatted_question_list.append({\n                    \"\
          role\": speaker_map[speaker],\n                    \"type\": \"eng_cn_audio\"\
          ,\n                    \"eng\": turn.get(\"line\", \"\"),\n            \
          \        \"audio_url\": True\n                })\n            # --- END:\
          \ æœ¬æ¬¡ä¸»è¦ä¿®æ”¹åŒºåŸŸ ---\n\n            original_chunks = scenario.get(\"reorder_chunks\"\
          , [])\n            shuffled_chunks = original_chunks[:]\n            random.shuffle(shuffled_chunks)\n\
          \            \n            options = []\n            for chunk in shuffled_chunks:\n\
          \                options.append({ \"key\": chunk, \"type\": \"text\", \"\
          text\": chunk })\n\n            processed_scenario = {\n               \
          \ \"question_turns\": formatted_question_list, # ä¼ é€’å¤„ç†å¥½çš„å¯¹è¯åˆ—è¡¨\n          \
          \      \"dialogue_turns_text_only\": dialogue_turns, # ä¿ç•™åŸå§‹å¯¹è¯ç”¨äºå®¡æ ¸\n    \
          \            \"correct_sentence\": scenario.get(\"sentence_to_reorder\"\
          , \"\"),\n                \"options\": options\n            }\n        \
          \    processed_scenarios.append(processed_scenario)\n\n        except Exception\
          \ as e:\n            print(f\"Error processing a scenario: {e}\")\n    \
          \        continue\n            \n    return {\"processed_scenarios\": processed_scenarios}"
        code_language: python3
        desc: ''
        outputs:
          processed_scenarios:
            children: null
            type: array[object]
        selected: false
        title: åœºæ™¯å¤„ç†ä¸è¯å—æ‰“ä¹±
        type: code
        variables:
        - value_selector:
          - '1753351954442'
          - text
          variable: llm_string_output
      height: 54
      id: '1753352030500'
      position:
        x: 1328.8658129030878
        y: 597.3489695291591
      positionAbsolute:
        x: 1328.8658129030878
        y: 597.3489695291591
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: "{% for scenario in processed_scenarios %}\n{\n    \"template\"\
          : \"t000009\",\n    \"remark\": \"å¬éŸ³é‡ç»„\",\n    \"type\":\"I\",\n    \"topic_id\"\
          :\"{{ cid }}\",\n    \"topic\":\"{{ topic }}\",\n    \"level\":\"{{ level\
          \ }}\",\n    \"vocabulary_group\":\"A\",\n    \"question\": [\n        {#\
          \ æ–°å¢çš„å¾ªç¯ï¼Œç”¨äºç”Ÿæˆæ¯ä¸€å¥å¯¹è¯ #}\n        {% for turn in scenario['question_turns']\
          \ %}\n        {\n            \"role\": \"{{ turn['role'] }}\",\n       \
          \     \"type\": \"eng_cn_audio\",\n            \"eng\": \"{{ turn['eng']\
          \ | e }}\",\n            \"audio_url\": true\n        }{% if not loop.last\
          \ %},{% endif %}\n        {% endfor %}\n    ],\n    \"show_conversation_text\"\
          :\"True\",\n    \"title\": \"é‡ç»„å¥å­\", \n    \"title_position\": 2, \n   \
          \ \"answer_type\": \"text\", \n    \"answer\": \"{{ scenario['correct_sentence']\
          \ | e }}\", \n    \"answer_input\": \"text_block\", \n    \"options\": [\n\
          \        {% for option in scenario['options'] %}\n        {\n          \
          \  \"key\": \"{{ option['key'] | e }}\",\n            \"type\": \"text\"\
          ,\n            \"text\": \"{{ option['text'] | e }}\"\n        }{% if not\
          \ loop.last %},{% endif %}\n        {% endfor %}\n    ]\n}\n{% if not loop.last\
          \ %},{% endif %}\n{% endfor %}"
        title: ç”Ÿæˆæœ€ç»ˆJSON 3
        type: template-transform
        variables:
        - value_selector:
          - '1753352030500'
          - processed_scenarios
          variable: processed_scenarios
        - value_selector:
          - '1753336166559'
          - topic
          value_type: string
          variable: topic
        - value_selector:
          - '1753336166559'
          - level
          value_type: string
          variable: level
        - value_selector:
          - '1753336166559'
          - cid
          value_type: string
          variable: cid
      height: 54
      id: '17536688854790'
      position:
        x: 1667.8211984834427
        y: 597.3489695291591
      positionAbsolute:
        x: 1667.8211984834427
        y: 597.3489695291591
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: 1072fafb-9760-4a13-854b-0b9c4bb99339
          role: system
          text: "# è§’è‰²\næ‚¨æ˜¯ä¸€ä½ä¸¥è°¨çš„AIæ•™ç ”å†…å®¹è´¨æ£€ä¸“å®¶ï¼Œè´Ÿè´£å¯¹JSONæ ¼å¼çš„â€œå¬éŸ³é‡ç»„â€é¢˜å¡æ•°æ®è¿›è¡Œè‡ªåŠ¨åŒ–è´¨é‡å®¡æ ¸ã€‚\n\n# ä»»åŠ¡\n\
            è¯·å¯¹ä»¥ä¸‹è¾“å…¥çš„JSONæ•°æ® ({{{{#17536688854790.output#}}}}) è¿›è¡Œä¸¥æ ¼çš„ã€é€é¡¹çš„æ ¡éªŒã€‚\n\n# æ ¸å¿ƒæ ¡éªŒè§„åˆ™\n\
            \n1.  **å­—æ®µå®Œæ•´æ€§ä¸æ ¼å¼**:\n    -   æ£€æŸ¥ `template`, `remark`, `question`, `title`,\
            \ `answer`, `options` ç­‰é¡¶çº§å­—æ®µæ˜¯å¦å­˜åœ¨ã€‚\n    -   `template` å­—æ®µçš„å€¼**å¿…é¡»**æ˜¯ `\"t000009\"\
            `ã€‚\n    -   `options` å­—æ®µ**å¿…é¡»**æ˜¯ä¸€ä¸ª**éç©ºæ•°ç»„**ã€‚\n\n2.  **å†…å®¹ä¸é€»è¾‘ä¸€è‡´æ€§ (æœ€é‡è¦)**:\n\
            \    -   **é‡ç»„æ ¡éªŒ**: å°†`options`æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ çš„`text`å€¼å–å‡ºï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦èƒ½**ä¸é‡ä¸æ¼åœ°**æ‹¼æ¥æˆ`answer`å­—æ®µä¸­çš„å®Œæ•´å¥å­ã€‚è¯­åºå¯ä»¥å¿½ç•¥ï¼Œä½†å†…å®¹å’Œæ•°é‡å¿…é¡»å®Œå…¨ä¸€è‡´ã€‚\n\
            \    -   **ä¸Šä¸‹æ–‡æ ¡éªŒ**: `answer`å­—æ®µä¸­çš„å®Œæ•´å¥å­ï¼Œæ˜¯å¦åœ¨`question`æ‰€ä»£è¡¨çš„å¯¹è¯ä¸Šä¸‹æ–‡ä¸­å‡ºç°è¿‡æˆ–é€»è¾‘ä¸Šå®Œå…¨åˆç†ï¼Ÿ\n\
            \n# è¾“å‡ºè¦æ±‚\nè¿”å›æ ‡å‡†JSONæ ¼å¼çš„ç»“æœã€‚è‹¥æœ‰ä»»ä½•ä¸€æ¡è§„åˆ™ä¸æ»¡è¶³ï¼Œ`is_valid`ä¸º`false`ï¼Œå¹¶åœ¨`error_details`ä¸­è¯¦ç»†è¯´æ˜é—®é¢˜ã€‚\n\
            \n{\n    \"is_valid\": bool,\n    \"error_details\": [\n        {\n  \
            \          \"field\": \"options/answer\",\n            \"issue_type\"\
            : \"INCONSISTENT_CONTENT\",\n            \"description\": \"å…·ä½“é—®é¢˜æè¿°ã€‚ä¾‹å¦‚ï¼š'optionsä¸­çš„è¯å—æ— æ³•å®Œæ•´æ‹¼æ¥æˆanswerå¥å­ï¼Œç¼ºå°‘äº†\
            \ 'of'ã€‚' æˆ– 'answerå¥å­å†…å®¹ä¸å¯¹è¯ä¸Šä¸‹æ–‡æ— å…³ã€‚'\",\n            \"suggestion\": \"ä¿®å¤å»ºè®®ï¼ˆå¯é€‰ï¼‰\"\
            \n        }\n    ],\n    \"validated_data\": {}\n}"
        selected: false
        title: é¢˜ç›®å‡†ç¡®æ€§æ ¡éªŒ (1)
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '17536688927820'
      position:
        x: 2009.2604710189908
        y: 597.3489695291591
      positionAbsolute:
        x: 2009.2604710189908
        y: 597.3489695291591
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: "{% for scenario in processed_scenarios %}\n## â å¡ç‰‡å®¡æ ¸æ¸…å• (å¬éŸ³é‡ç»„)\n\
          \n---\n\n### **1. åŸºæœ¬ä¿¡æ¯**\n\n- **å¯¹è¯ID**: `{{ scenario['conversation_id']\
          \ }}`\n- **æ¨¡æ¿ç±»å‹**: `t000009` (å¬éŸ³é‡ç»„)\n\n### **2. å¯¹è¯å†…å®¹é¢„è§ˆ**\n\n{% for turn\
          \ in scenario['dialogue_turns_text_only'] %}\n- **{{ turn['speaker'] }}**:\
          \ {{ turn['line'] }}\n{% endfor %}\n\n### **3. å¥å­é‡ç»„ä»»åŠ¡**\n\n- **æ ‡å‡†ç­”æ¡ˆ (å®Œæ•´å¥å­)**:\
          \ {{ scenario['correct_sentence'] }}\n- **æ‰“ä¹±çš„è¯å— (Options)**:\n  - `{{ scenario['options']\
          \ | map(attribute='text') | join(\"` `\") }}`\n\n### **4. æ ¡éªŒè¦ç‚¹**\n- [ ]\
          \ è¯å—åˆ’åˆ†æ˜¯å¦åˆç†ã€æœ‰æ„ä¹‰ï¼Ÿ\n- [ ] è¯å—æ˜¯å¦èƒ½å‡†ç¡®æ— è¯¯åœ°è¿˜åŸæˆæ ‡å‡†ç­”æ¡ˆï¼Ÿ\n- [ ] ä»»åŠ¡å¥å­çš„éš¾åº¦æ˜¯å¦ç¬¦åˆè®¾å®šçš„è¯­è¨€ç­‰çº§ï¼Ÿ\n\n\
          {% if not loop.last %}\n\n========================================\n\n{%\
          \ endif %}\n{% endfor %}"
        title: äººå·¥å®¡æ ¸æ ¼å¼è½¬æ¢ -12
        type: template-transform
        variables:
        - value_selector:
          - '1753352030500'
          - processed_scenarios
          variable: processed_scenarios
      height: 54
      id: '17536688996950'
      position:
        x: 2328.156505206653
        y: 597.3489695291591
      positionAbsolute:
        x: 2328.156505206653
        y: 597.3489695291591
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: ada8314a-0052-410c-a0fe-9d29c133e0a2
          role: system
          text: "# è§’è‰²\næ‚¨æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿è‹±è¯­æ•™å­¦ä¸“å®¶ï¼Œæ“…é•¿è®¾è®¡è€ƒéªŒçœŸå®ç†è§£èƒ½åŠ›çš„å¯¹è¯æƒ…æ™¯é¢˜ã€‚\n\n# ä»»åŠ¡\nè¯·æ ¹æ®ç”¨æˆ·è¾“å…¥çš„è¯é¢˜{{#1753336166559.topic#}}ã€éš¾åº¦æ°´å¹³{{#1753336166559.level#}}å’Œç”Ÿæˆæ•°é‡{{#1753336166559.num_questions_type_11#}}ï¼Œåˆ›ä½œå‡ºå®Œæ•´çš„â€œå¯¹è¯ç†è§£â€åœºæ™¯ã€‚\n\
            \n# åœºæ™¯è¦æ±‚\næ¯ä¸ªåœºæ™¯å¿…é¡»åŒ…å«ï¼š\n1.  **å¯¹è¯å†…å®¹ (dialogue_turns)**ï¼šä¸€æ®µåŒ…å«2-4è½®ã€æœ‰å…·ä½“æƒ…æ™¯çš„è‹±æ–‡å¯¹è¯ã€‚\n\
            2.  **ç†è§£æ€§é—®é¢˜ (comprehension_question_cn)**ï¼šä¸€ä¸ªå…³äºå¯¹è¯å†…å®¹çš„ä¸­æ–‡é—®é¢˜ï¼Œå¯ä»¥é—®è¯´è¯äººçš„æ„å›¾ã€æŸå¥è¯çš„å«ä¹‰ã€æˆ–è€…å¯¹è¯çš„æŸä¸ªç»†èŠ‚ã€‚\n\
            3.  **æ­£ç¡®ä¸­æ–‡é€‰é¡¹ (correct_option_cn)**ï¼šå¯¹ä¸Šè¿°é—®é¢˜çš„æ­£ç¡®å›ç­”ï¼Œå¿…é¡»æ˜¯ä¸­æ–‡ã€‚\n4.  **å¹²æ‰°ä¸­æ–‡é€‰é¡¹ (distractor_options_cn)**ï¼šä¸€ä¸ªæˆ–å¤šä¸ªé€»è¾‘ä¸Šçœ‹ä¼¼åˆç†ä½†å®é™…é”™è¯¯çš„ä¸­æ–‡å¹²æ‰°é¡¹ã€‚\n\
            5.  **å¯¹äºè‹±è¯­æ°´å¹³ï¼ˆlevelï¼‰çš„å®šä¹‰**ï¼š\n  - Level 1ï¼šèƒ½ç†è§£å¸¸è§è¯æ±‡ä¸åŸºæœ¬æŒ‡ä»¤\n  - Level 2ï¼šèƒ½è¿›è¡Œé—®å€™ã€è‡ªæˆ‘ä»‹ç»ã€è¡¨è¾¾å–œå¥½\n\
            \  - Level 3ï¼šå¯ç”¨å®Œæ•´å¥å‹æè¿°æ—¥å¸¸æƒ…å¢ƒ\n  - Level 4ï¼šèƒ½å›´ç»•ç†Ÿæ‚‰è¯é¢˜è¿›è¡Œè¿è´¯è¡¨è¾¾\n  - Level 5ï¼šè¡¨è¾¾è¾ƒä¸ºæµç•…ï¼Œèƒ½è¡¨è¾¾è§‚ç‚¹å’Œç†è§£ä¸€èˆ¬æ–‡æœ¬\n\
            \  - Level 6ï¼šèƒ½è¿›è¡Œæ—¥å¸¸äº¤æµä¸åŸºç¡€ä¹¦é¢è¡¨è¾¾\n\n# å¼ºåˆ¶è§„åˆ™ (MANDATORY RULES)\n-   æ‰€æœ‰å­—æ®µï¼Œç‰¹åˆ«æ˜¯`line`,\
            \ `comprehension_question_cn`, `correct_option_cn`ç­‰ï¼Œä¸¥ç¦ä¸ºç©ºå­—ç¬¦ä¸²ã€‚\n-   é—®é¢˜å’Œé€‰é¡¹å¿…é¡»ä¸å¯¹è¯å†…å®¹ç´§å¯†ç›¸å…³ï¼Œä¸”éš¾åº¦ç¬¦åˆè®¾å®šçš„è¯­è¨€ç­‰çº§ã€‚\n\
            -   ä¸¥æ ¼æŒ‰ç…§ä¸‹é¢ç¤ºä¾‹çš„JSONæ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„è§£é‡Šã€‚\n\n# è¾“å‡ºæ ¼å¼\nè¯·è¾“å‡ºä¸€ä¸ªæ ‡å‡† JSON å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º\
            \ `scenarios` çš„æ•°ç»„ã€‚\n\n## ç¤ºä¾‹è¾“å‡º (è¾“å…¥: topic=\"æ‰“è½¦\", level=\"Level 3\", card_quantity=1)\n\
            {\n  \"scenarios\": [\n    {\n      \"dialogue_turns\": [\n        {\n\
            \          \"speaker\": \"A\",\n          \"line\": \"What color is the\
            \ cab coming in this way?\"\n        },\n        {\n          \"speaker\"\
            : \"B\",\n          \"line\": \"what?\"\n        },\n        {\n     \
            \     \"speaker\": \"A\",\n          \"line\": \"I said what is the color\
            \ of your cab?\"\n        }\n      ],\n      \"comprehension_question_cn\"\
            : \"åˆšåˆšè¯´è¯çš„äººAæœ€åæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\",\n      \"correct_option_cn\": \"å¥¹æƒ³çŸ¥é“å‡ºç§Ÿè½¦çš„é¢œè‰²ã€‚\",\n\
            \      \"distractor_options_cn\": [\n        \"å¥¹æƒ³å»æœºåœºã€‚\",\n        \"å¥¹æƒ³ä»˜é’±ã€‚\"\
            \n      ]\n    }\n  ]\n}"
        selected: false
        title: ç†è§£åœºæ™¯ç”Ÿæˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1753671925489'
      position:
        x: 902.0493841724706
        y: 298.3751944853851
      positionAbsolute:
        x: 902.0493841724706
        y: 298.3751944853851
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import random\nimport time\nimport json\n\ndef main(llm_string_output:\
          \ str) -> dict:\n    processed_scenarios = []\n    \n    try:\n        data\
          \ = json.loads(llm_string_output)\n        scenarios_list = data.get(\"\
          scenarios\", [])\n    except json.JSONDecodeError:\n        return {\"error\"\
          : f\"Input string is not a valid JSON. Content: {llm_string_output}\", \"\
          processed_scenarios\": []}\n\n    if not scenarios_list:\n        return\
          \ {\"error\": \"No scenarios found in the parsed JSON.\", \"processed_scenarios\"\
          : []}\n\n    for scenario in scenarios_list:\n        try:\n           \
          \ # --- START: æœ¬æ¬¡ä¸»è¦ä¿®æ”¹åŒºåŸŸ ---\n            dialogue_turns = scenario.get(\"\
          dialogue_turns\", [])\n            formatted_question_list = []\n      \
          \      \n            # å‡è®¾ç¬¬ä¸€ä¸ªè¯´è¯äººæ˜¯ \"left_girl\"ï¼Œç„¶åäº¤æ›¿\n            speaker_map\
          \ = {}\n            for i, turn in enumerate(dialogue_turns):\n        \
          \        speaker = turn.get(\"speaker\")\n                if speaker not\
          \ in speaker_map:\n                    # å¦‚æœæ˜¯æ–°å‡ºç°çš„è¯´è¯äººï¼Œæ ¹æ®å½“å‰å·²è®°å½•çš„è¯´è¯äººæ•°é‡åˆ†é…è§’è‰²\n\
          \                    role = \"left_girl\" if len(speaker_map) % 2 == 0 else\
          \ \"right_girl\"\n                    speaker_map[speaker] = role\n\n  \
          \              formatted_question_list.append({\n                    \"\
          role\": speaker_map[speaker],\n                    \"type\": \"eng_cn_audio\"\
          ,\n                    \"eng\": turn.get(\"line\", \"\"),\n            \
          \        \"audio_url\": True\n                })\n            # --- END:\
          \ æœ¬æ¬¡ä¸»è¦ä¿®æ”¹åŒºåŸŸ ---\n\n            correct_text = scenario.get(\"correct_option_cn\"\
          )\n            all_options_text = [correct_text] + scenario.get(\"distractor_options_cn\"\
          , [])\n            random.shuffle(all_options_text)\n            \n    \
          \        final_options = []\n            answer_key = \"\"\n           \
          \ for i, text in enumerate(all_options_text):\n                key = chr(65\
          \ + i)\n                option_data = { \"key\": key, \"type\": \"text\"\
          , \"text\": text }\n                final_options.append(option_data)\n\
          \                if text == correct_text:\n                    answer_key\
          \ = key\n            \n            processed_scenario = {\n            \
          \    # ä¸å†éœ€è¦ conversation_id å’Œ message_end\n                \"question_turns\"\
          : formatted_question_list, # ä¼ é€’å¤„ç†å¥½çš„å¯¹è¯åˆ—è¡¨\n                \"dialogue_turns_text_only\"\
          : dialogue_turns, # ä¿ç•™åŸå§‹å¯¹è¯ç”¨äºå®¡æ ¸\n                \"comprehension_question_cn\"\
          : scenario.get(\"comprehension_question_cn\", \"\"),\n                \"\
          answer_key\": answer_key,\n                \"options\": final_options\n\
          \            }\n            processed_scenarios.append(processed_scenario)\n\
          \n        except Exception as e:\n            print(f\"Error processing\
          \ a scenario: {e}\")\n            continue\n            \n    return {\"\
          processed_scenarios\": processed_scenarios}"
        code_language: python3
        desc: ''
        outputs:
          processed_scenarios:
            children: null
            type: array[object]
        selected: false
        title: åœºæ™¯å¤„ç†ä¸é€‰é¡¹æ ¼å¼åŒ–
        type: code
        variables:
        - value_selector:
          - '1753671925489'
          - text
          variable: llm_string_output
      height: 54
      id: '1753672356709'
      position:
        x: 1328.8658129030878
        y: 298.3751944853851
      positionAbsolute:
        x: 1328.8658129030878
        y: 298.3751944853851
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: "{% for scenario in processed_scenarios %}\n{\n    \"template\"\
          : \"t000008\",\n    \"remark\": \"å¯¹è¯ç†è§£\",\n    \"type\":\"H\",\n    \"topic_id\"\
          :\"{{ cid }}\",\n    \"topic\":\"{{ topic }}\",\n    \"level\":\"{{ level\
          \ }}\",\n    \"vocabulary_group\":\"A\",\n    \"question\": [\n        {#\
          \ æ–°å¢çš„å¾ªç¯ï¼Œç”¨äºç”Ÿæˆæ¯ä¸€å¥å¯¹è¯ #}\n        {% for turn in scenario['question_turns']\
          \ %}\n        {\n            \"role\": \"{{ turn['role'] }}\",\n       \
          \     \"type\": \"eng_cn_audio\",\n            \"eng\": \"{{ turn['eng']\
          \ | e }}\",\n            \"audio_url\": true\n        }{% if not loop.last\
          \ %},{% endif %}\n        {% endfor %}\n    ],\n    \"title\": \"{{ scenario['comprehension_question_cn']\
          \ | e }}\",\n    \"title_position\": 2,\n    \"answer_type\": \"text\",\n\
          \    \"answer\": \"{{ scenario['answer_key'] }}\",\n    \"answer_input\"\
          : \"radio\",\n    \"options\": [\n        {% for option in scenario['options']\
          \ %}\n        {\n            \"key\": \"{{ option['key'] }}\",\n       \
          \     \"type\": \"text\",\n            \"text\": \"{{ option['text'] | e\
          \ }}\"\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n\
          \    ]\n}\n{% if not loop.last %},{% endif %}\n{% endfor %}"
        title: ç”Ÿæˆæœ€ç»ˆJSON 2
        type: template-transform
        variables:
        - value_selector:
          - '1753672356709'
          - processed_scenarios
          variable: processed_scenarios
        - value_selector:
          - '1753336166559'
          - topic
          value_type: string
          variable: topic
        - value_selector:
          - '1753336166559'
          - level
          value_type: string
          variable: level
        - value_selector:
          - '1753336166559'
          - cid
          value_type: string
          variable: cid
      height: 54
      id: '1753672437742'
      position:
        x: 1667.8211984834427
        y: 298.3751944853851
      positionAbsolute:
        x: 1667.8211984834427
        y: 298.3751944853851
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: 1072fafb-9760-4a13-854b-0b9c4bb99339
          role: system
          text: "# è§’è‰²\næ‚¨æ˜¯ä¸€ä½ä¸¥è°¨çš„AIæ•™ç ”å†…å®¹è´¨æ£€ä¸“å®¶ï¼Œè´Ÿè´£å¯¹JSONæ ¼å¼çš„â€œå¯¹è¯ç†è§£â€é¢˜å¡æ•°æ®è¿›è¡Œè‡ªåŠ¨åŒ–è´¨é‡å®¡æ ¸ã€‚\n\n# ä»»åŠ¡\n\
            è¯·å¯¹ä»¥ä¸‹è¾“å…¥çš„JSONæ•°æ® ({{{{#1753672437742.output#}}}}) è¿›è¡Œä¸¥æ ¼çš„ã€é€é¡¹çš„æ ¡éªŒã€‚\n\n# æ ¸å¿ƒæ ¡éªŒè§„åˆ™\n\
            1.  **å­—æ®µä¸æ ¼å¼**: `template` å¿…é¡»æ˜¯ `\"t000008\"`ã€‚`options` å¿…é¡»æ˜¯åŒ…å«è‡³å°‘2ä¸ªå¯¹è±¡çš„éç©ºæ•°ç»„ã€‚\n\
            2.  **Questionç»“æ„æ ¡éªŒ**: `question`å­—æ®µå¿…é¡»æ˜¯ä¸€ä¸ª**éç©ºæ•°ç»„**ï¼Œä¸”æ•°ç»„å†…çš„æ¯ä¸ªå¯¹è±¡éƒ½å¿…é¡»åŒ…å«`role`,\
            \ `type`, `eng`, `audio_url`è¿™å››ä¸ªé”®ã€‚\n3.  **é€»è¾‘ä¸€è‡´æ€§ (æœ€é‡è¦)**:\n    -   æ ¹æ®`question`æ•°ç»„ä¸­å‘ˆç°çš„å®Œæ•´å¯¹è¯å†…å®¹ï¼Œåˆ¤æ–­`title`ä¸­çš„é—®é¢˜æ˜¯å¦ä¸å¯¹è¯ç›¸å…³ã€‚\n\
            \    -   åˆ¤æ–­`answer`å­—æ®µæŒ‡å‘çš„æ­£ç¡®é€‰é¡¹ï¼Œå…¶å†…å®¹æ˜¯å¦çœŸçš„æ˜¯å¯¹`title`é—®é¢˜çš„æ­£ç¡®å›ç­”ã€‚\n\n# è¾“å‡ºè¦æ±‚\nè¿”å›æ ‡å‡†JSONæ ¼å¼ç»“æœã€‚\n\
            { \"is_valid\": bool, \"error_details\": [], \"validated_data\": {} }"
        selected: false
        title: 'é¢˜ç›®å‡†ç¡®æ€§æ ¡éªŒ '
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '17536724640920'
      position:
        x: 2009.2604710189908
        y: 298.3751944853851
      positionAbsolute:
        x: 2009.2604710189908
        y: 298.3751944853851
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: "{% for scenario in processed_scenarios %}\n## â å¡ç‰‡å®¡æ ¸æ¸…å• (å¯¹è¯ç†è§£)\n\
          \n---\n\n### **1. åŸºæœ¬ä¿¡æ¯**\n- **å¯¹è¯ID**: `{{ scenario['conversation_id'] }}`\n\
          - **æ¨¡æ¿ç±»å‹**: `t000008` (å¯¹è¯ç†è§£)\n\n### **2. å¯¹è¯å†…å®¹é¢„è§ˆ**\n{% for turn in scenario['dialogue_turns_text_only']\
          \ %}\n- **{{ turn['speaker'] }}**: {{ turn['line'] }}\n{% endfor %}\n\n\
          ### **3. ç†è§£é¢˜ä»»åŠ¡**\n- **é—®é¢˜ (ä¸­æ–‡)**: {{ scenario['comprehension_question_cn']\
          \ }}\n- **é€‰é¡¹åˆ—è¡¨**:\n{% for option in scenario['options'] %}\n  - **[{{ option['key']\
          \ }}]**: {{ option['text'] }}{% if option['key'] == scenario.answer_key\
          \ %}  **<-- âœ… æ­£ç¡®ç­”æ¡ˆ**{% endif %}\n{% endfor %}\n\n### **4. æ ¡éªŒè¦ç‚¹**\n- [ ]\
          \ é—®é¢˜æ˜¯å¦æ¸…æ™°ï¼Œä¸”ä¸å¯¹è¯å†…å®¹ç´§å¯†ç›¸å…³ï¼Ÿ\n- [ ] æ­£ç¡®ç­”æ¡ˆæ˜¯å¦å‡†ç¡®æ— è¯¯ï¼Ÿ\n- [ ] å¹²æ‰°é¡¹æ˜¯å¦æœ‰è¿·æƒ‘æ€§ä¸”ä¸å«äº‰è®®ï¼Ÿ\n- [ ] æ•´ä½“éš¾åº¦æ˜¯å¦ç¬¦åˆè®¾å®šçš„è¯­è¨€ç­‰çº§ï¼Ÿ\n\
          \n{% if not loop.last %}\n========================================\n{% endif\
          \ %}\n{% endfor %}"
        title: äººå·¥å®¡æ ¸æ ¼å¼è½¬æ¢ -11
        type: template-transform
        variables:
        - value_selector:
          - '1753672356709'
          - processed_scenarios
          variable: processed_scenarios
      height: 54
      id: '17536724676350'
      position:
        x: 2328.156505206653
        y: 298.3751944853851
      positionAbsolute:
        x: 2328.156505206653
        y: 298.3751944853851
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: be234b27-fc9b-4003-8da4-e0994cda10d4
          role: system
          text: "# è§’è‰²\næ‚¨æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„å„¿ç«¥è‹±è¯­æ•™ç ”ä¸“å®¶ï¼Œæ“…é•¿å›´ç»•ä¸»é¢˜è®¾è®¡è¯æ±‡å­¦ä¹ æ¸¸æˆï¼Œå¯¹æ•™å­¦å†…å®¹çš„æ ‡å‡†åŒ–æœ‰ä¸¥æ ¼è¦æ±‚ã€‚\n\n# ä»»åŠ¡\n\
            è¯·æ ¹æ®ç”¨æˆ·è¾“å…¥çš„ **è¯é¢˜ ({{{{#1753336166559.topic#}}}})**ã€**è‹±è¯­æ°´å¹³ ({{{{#1753336166559.level#}}}})**\
            \ å’Œ **å¡ç‰‡æ•°é‡ ({{{{#1753336166559.num_questions_type_10#}}}})**ï¼Œåˆ›ä½œå‡ºæŒ‡å®šæ•°é‡çš„ã€å„è‡ªç‹¬ç«‹çš„â€œéŸ³é¢‘é…å¯¹â€æ¸¸æˆåœºæ™¯ã€‚\n\
            \n# å†…å®¹è¦æ±‚\næ¯ä¸ªç‹¬ç«‹çš„æ¸¸æˆåœºæ™¯éƒ½å¿…é¡»åŒ…å«ï¼š\n1.  **ä¸»é¢˜çŸ­è¯­ (theme_phrase)**: ä¸€ä¸ªä¸è¯é¢˜ç›¸å…³çš„ã€ç”¨ä½œå¡ç‰‡é¡¶éƒ¨å±•ç¤ºçš„è‹±æ–‡çŸ­è¯­ã€‚\n\
            2.  **è¯æ±‡é…å¯¹ (vocabulary_pairs)**: ä¸€ä¸ªåŒ…å«3-5ä¸ªä¸­è‹±æ–‡è¯æ±‡é…å¯¹çš„åˆ—è¡¨ã€‚\n3.  **å¯¹äºè‹±è¯­æ°´å¹³ï¼ˆlevelï¼‰çš„å®šä¹‰**ï¼š\n\
            \  - Level 1ï¼šèƒ½ç†è§£å¸¸è§è¯æ±‡ä¸åŸºæœ¬æŒ‡ä»¤\n  - Level 2ï¼šèƒ½è¿›è¡Œé—®å€™ã€è‡ªæˆ‘ä»‹ç»ã€è¡¨è¾¾å–œå¥½\n  - Level 3ï¼šå¯ç”¨å®Œæ•´å¥å‹æè¿°æ—¥å¸¸æƒ…å¢ƒ\n\
            \  - Level 4ï¼šèƒ½å›´ç»•ç†Ÿæ‚‰è¯é¢˜è¿›è¡Œè¿è´¯è¡¨è¾¾\n  - Level 5ï¼šè¡¨è¾¾è¾ƒä¸ºæµç•…ï¼Œèƒ½è¡¨è¾¾è§‚ç‚¹å’Œç†è§£ä¸€èˆ¬æ–‡æœ¬\n  - Level\
            \ 6ï¼šèƒ½è¿›è¡Œæ—¥å¸¸äº¤æµä¸åŸºç¡€ä¹¦é¢è¡¨è¾¾\n\n# å¼ºåˆ¶è§„åˆ™ (MANDATORY RULES)\n-   **ç¿»è¯‘å‡†ç¡®æ€§**: `cn`å­—æ®µå¿…é¡»æ˜¯`eng`å­—æ®µåœ¨ä¸­å›½å¤§é™†åœ°åŒºæœ€å¸¸ç”¨ã€æœ€æ ‡å‡†çš„ç®€ä½“ä¸­æ–‡ç¿»è¯‘ã€‚é¿å…ä½¿ç”¨è¿‡äºå£è¯­åŒ–ã€åœ°åŸŸæ€§æˆ–ç”Ÿåƒ»çš„è¡¨è¾¾ã€‚ä¾‹å¦‚ï¼Œå¯¹äº\
            \ \"take a taxi\"ï¼Œä¼˜å…ˆä½¿ç”¨â€œæ‰“è½¦â€æˆ–â€œä¹˜åå‡ºç§Ÿè½¦â€ï¼Œè€Œä¸æ˜¯â€œæ­çš„å£«â€ã€‚\n-   æ‰€æœ‰å†…å®¹å¿…é¡»ä¸¥æ ¼ç¬¦åˆæŒ‡å®šçš„è¯­è¨€ç­‰çº§å’Œè¯é¢˜ã€‚\n\
            -   ä¸¥æ ¼æŒ‰ç…§ä¸‹é¢ç¤ºä¾‹çš„JSONæ ¼å¼è¾“å‡ºï¼Œæœ€å¤–å±‚æ˜¯ä¸€ä¸ªåŒ…å« `card_quantity` ä¸ªåœºæ™¯å¯¹è±¡çš„ `scenarios` æ•°ç»„ã€‚\n\
            \n# è¾“å‡ºæ ¼å¼\nè¯·è¾“å‡ºä¸€ä¸ªæ ‡å‡† JSON å¯¹è±¡ã€‚\n\n## ç¤ºä¾‹è¾“å‡º (è¾“å…¥: topic=\"æ‰“è½¦\", level=\"Level\
            \ 1\", card_quantity=1)\n{\n  \"scenarios\": [\n    {\n      \"theme_phrase\"\
            : \"Let's Go by Taxi!\",\n      \"vocabulary_pairs\": [\n        { \"\
            eng\": \"taxi\", \"cn\": \"å‡ºç§Ÿè½¦\" },\n        { \"eng\": \"driver\", \"\
            cn\": \"å¸æœº\" },\n        { \"eng\": \"fare\", \"cn\": \"è½¦è´¹\" }\n     \
            \ ]\n    }\n  ]\n}"
        selected: false
        title: è¯æ±‡ä¸ä¸»é¢˜ç”Ÿæˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1753673016249'
      position:
        x: 902.0493841724706
        y: 14.415215597157882
      positionAbsolute:
        x: 902.0493841724706
        y: 14.415215597157882
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import random\nimport time\nimport json\n\ndef main(llm_string_output:\
          \ str) -> dict:\n    \n    try:\n        data = json.loads(llm_string_output)\n\
          \        scenarios_list = data.get(\"scenarios\", [])\n    except json.JSONDecodeError:\n\
          \        return {\"error\": \"Input is not valid JSON.\", \"processed_cards\"\
          : []}\n\n    if not scenarios_list:\n        return {\"error\": \"No scenarios\
          \ found.\", \"processed_cards\": []}\n\n    processed_cards = []\n    for\
          \ scenario in scenarios_list:\n        theme_phrase = scenario.get(\"theme_phrase\"\
          , \"Default Theme\")\n        vocab_pairs = scenario.get(\"vocabulary_pairs\"\
          , [])\n        \n        if not vocab_pairs:\n            continue\n\n \
          \       left_options = []\n        right_options = []\n\n        for pair\
          \ in vocab_pairs:\n            eng_word = pair.get(\"eng\")\n          \
          \  cn_word = pair.get(\"cn\")\n            if not eng_word or not cn_word:\
          \ continue\n            \n            key = eng_word\n\n            # æ„å»ºæ–°çš„\
          \ left_options ç»“æ„\n            left_options.append({\n                \"\
          key\": key,\n                \"type\": \"audio\",\n                \"audio_url\"\
          : True \n            })\n            # æ„å»ºæ–°çš„ right_options ç»“æ„\n         \
          \   right_options.append({\n                \"key\": key,\n            \
          \    \"type\": \"text\",\n                \"text\": cn_word\n          \
          \  })\n\n        # ç‹¬ç«‹éšæœºæ‰“ä¹±ä¸¤ä¸ªåˆ—è¡¨\n        random.shuffle(left_options)\n  \
          \      random.shuffle(right_options)\n\n        processed_cards.append({\n\
          \            \"theme_phrase\": theme_phrase,\n            \"left_options\"\
          : left_options,\n            \"right_options\": right_options,\n       \
          \ })\n            \n    return {\"processed_cards\": processed_cards}"
        code_language: python3
        desc: ''
        outputs:
          processed_cards:
            children: null
            type: array[object]
        selected: false
        title: é…å¯¹å¤„ç†ä¸éšæœºåŒ–
        type: code
        variables:
        - value_selector:
          - '1753673016249'
          - text
          variable: llm_string_output
      height: 54
      id: '1753673086906'
      position:
        x: 1328.8658129030878
        y: 14.41521559715784
      positionAbsolute:
        x: 1328.8658129030878
        y: 14.41521559715784
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gpt-4.1-mini
          provider: langgenius/openai/openai
        prompt_template:
        - id: 56dd5c0f-4f22-42eb-a40d-77c938bab728
          role: system
          text: '# è§’è‰²

            æ‚¨æ˜¯ä¸€ä½ä¸¥è°¨çš„AIæ•™ç ”å†…å®¹è´¨æ£€ä¸“å®¶ï¼Œè´Ÿè´£å¯¹JSONæ ¼å¼çš„â€œéŸ³é¢‘é…å¯¹â€é¢˜å¡æ•°æ®è¿›è¡Œè‡ªåŠ¨åŒ–è´¨é‡å®¡æ ¸ã€‚


            # ä»»åŠ¡

            è¯·å¯¹ä»¥ä¸‹è¾“å…¥çš„JSONæ•°æ®{{#1753673197346.output#}}è¿›è¡Œä¸¥æ ¼æ ¡éªŒã€‚


            # æ ¸å¿ƒæ ¡éªŒè§„åˆ™

            1.  **å­—æ®µå®Œæ•´æ€§ä¸æ ¼å¼**: å¿…é¡»å­˜åœ¨ `template`, `remark`, `question`, `left_options`,
            `right_options` å­—æ®µã€‚`answer`å’Œ`answer_type`å­—æ®µä¸åº”å­˜åœ¨ã€‚

            2.  **Keyä¸€è‡´æ€§**: `left_options` ä¸­çš„æ‰€æœ‰`key`çš„é›†åˆï¼Œå¿…é¡»ä¸`right_options`ä¸­çš„æ‰€æœ‰`key`çš„é›†åˆå®Œå…¨ç›¸åŒã€‚

            3.  **å†…éƒ¨ç»“æ„**: `left_options`ä¸­æ¯ä¸ªå¯¹è±¡çš„`type`å¿…é¡»æ˜¯`"audio"`ã€‚`right_options`ä¸­æ¯ä¸ªå¯¹è±¡çš„`type`å¿…é¡»æ˜¯`"text"`ã€‚

            4.  **ç¿»è¯‘å‡†ç¡®æ€§ (æœ€é‡è¦)**: å¯¹äºä»»æ„ä¸€ä¸ªç›¸åŒçš„keyï¼Œåœ¨`left_options`ä¸­æ‰¾åˆ°è¯¥keyï¼ˆå®ƒä»£è¡¨ä¸€ä¸ªè‹±æ–‡å•è¯ï¼‰ï¼Œåœ¨`right_options`ä¸­æ‰¾åˆ°å¯¹åº”çš„ä¸­æ–‡`text`ï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦æ˜¯æ­£ç¡®çš„ç¿»è¯‘å…³ç³»ã€‚


            # è¾“å‡ºè¦æ±‚

            è¿”å›æ ‡å‡†JSONæ ¼å¼ç»“æœã€‚

            { "is_valid": bool, "error_details": [], "validated_data": {} }'
        selected: false
        title: 'é¢˜ç›®å‡†ç¡®æ€§æ ¡éªŒ '
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1753673132811'
      position:
        x: 2009.2604710189908
        y: 14.41521559715784
      positionAbsolute:
        x: 2009.2604710189908
        y: 14.41521559715784
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: "{% for card in processed_cards %}\n{\n    \"template\": \"t000007\"\
          ,\n    \"remark\": \"éŸ³é¢‘é…å¯¹\",\n    \"type\":\"G\",\n    \"topic_id\":\"{{\
          \ cid }}\",\n    \"topic\":\"{{ topic }}\",\n    \"level\":\"{{ level }}\"\
          ,\n    \"vocabulary_group\":\"A\",\n    \"question\": [\n        {\n   \
          \         \"role\": \"theme_with_image\",\n            \"type\": \"image_eng_audio\"\
          ,\n            \"eng\": \"{{ card['theme_phrase'] | e }}\",\n          \
          \  \"audio_url\": true,\n            \"image_url\": true\n        }\n  \
          \   ],\n    \"title\": \"é€‰æ‹©é…å¯¹\", \n    \"title_position\": 2, \n    \"answer_input\"\
          : \"match\", \n    \"left_options\": {{ card['left_options'] | tojson }},\n\
          \    \"right_options\": {{ card['right_options'] | tojson }}\n}\n{% if not\
          \ loop.last %},{% endif %}\n{% endfor %}"
        title: ç”Ÿæˆæœ€ç»ˆJSON 1
        type: template-transform
        variables:
        - value_selector:
          - '1753673086906'
          - processed_cards
          variable: processed_cards
        - value_selector:
          - '1753336166559'
          - topic
          value_type: string
          variable: topic
        - value_selector:
          - '1753336166559'
          - level
          value_type: string
          variable: level
        - value_selector:
          - '1753336166559'
          - cid
          value_type: string
          variable: cid
      height: 54
      id: '1753673197346'
      position:
        x: 1667.8211984834427
        y: 14.415215597157882
      positionAbsolute:
        x: 1667.8211984834427
        y: 14.415215597157882
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{% for card in processed_cards %}

          ## â å¡ç‰‡å®¡æ ¸æ¸…å• (éŸ³é¢‘é…å¯¹)


          ---


          ### **1. æ ¸å¿ƒå†…å®¹**

          - **ä¸»é¢˜çŸ­è¯­**: {{ card[''theme_phrase''] }}

          - **æ¨¡æ¿ç±»å‹**: `t000007` (éŸ³é¢‘é…å¯¹)


          ### **2. é…å¯¹è¯æ±‡åˆ—è¡¨ (å®¡æ ¸å‘˜è¯·æ£€æŸ¥ç¿»è¯‘æ˜¯å¦å‡†ç¡®)**


          | è‹±æ–‡ (English) | ä¸­æ–‡ (Chinese) |

          | :--- | :--- |

          {% for left_item in card[''left_options''] %}

          {% set current_key = left_item[''key''] %}

          {% for right_item in card[''right_options''] if right_item[''key''] == current_key
          %}

          | {{ left_item[''key''] }} | {{ right_item[''text''] }} |

          {% endfor %}

          {% endfor %}


          ### **3. æ ¡éªŒè¦ç‚¹**

          - [ ] ä¸»é¢˜çŸ­è¯­æ˜¯å¦ä¸è¯æ±‡ç›¸å…³ï¼Ÿ

          - [ ] æ‰€æœ‰ä¸­è‹±æ–‡ç¿»è¯‘æ˜¯å¦å‡†ç¡®ã€åœ°é“ï¼Ÿ

          - [ ] è¯æ±‡éš¾åº¦æ˜¯å¦ç¬¦åˆè®¾å®šçš„è¯­è¨€ç­‰çº§ï¼Ÿ


          {% if not loop.last %}

          ========================================

          {% endif %}

          {% endfor %}'
        title: äººå·¥å®¡æ ¸æ ¼å¼è½¬æ¢-10
        type: template-transform
        variables:
        - value_selector:
          - '1753673086906'
          - processed_cards
          variable: processed_cards
      height: 54
      id: '17536732746160'
      position:
        x: 2328.156505206653
        y: 14.41521559715784
      positionAbsolute:
        x: 2328.156505206653
        y: 14.41521559715784
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import random\nimport time\nimport json\n\ndef main(llm_string_output:\
          \ str) -> dict:\n    processed_scenarios = []\n    \n    try:\n        data\
          \ = json.loads(llm_string_output)\n        scenarios_list = data.get(\"\
          scenarios\", [])\n    except json.JSONDecodeError:\n        return {\"error\"\
          : f\"Input string is not a valid JSON. Content: {llm_string_output}\", \"\
          processed_scenarios\": []}\n\n    if not scenarios_list:\n        return\
          \ {\"error\": \"No scenarios found in the parsed JSON.\", \"processed_scenarios\"\
          : []}\n\n    for scenario in scenarios_list:\n        try:\n           \
          \ # --- START: æœ¬æ¬¡ä¸»è¦ä¿®æ”¹åŒºåŸŸ ---\n            dialogue_turns = scenario.get(\"\
          dialogue_turns\", [])\n            formatted_question_list = []\n      \
          \      speaker_map = {}\n            for i, turn in enumerate(dialogue_turns):\n\
          \                speaker = turn.get(\"speaker\")\n                if speaker\
          \ not in speaker_map:\n                    role = \"left_girl\" if len(speaker_map)\
          \ % 2 == 0 else \"right_girl\"\n                    speaker_map[speaker]\
          \ = role\n\n                formatted_question_list.append({\n         \
          \           \"role\": speaker_map[speaker],\n                    \"type\"\
          : \"eng_cn_audio\",\n                    \"eng\": turn.get(\"line\", \"\"\
          ),\n                    \"audio_url\": True\n                })\n      \
          \      # --- END: æœ¬æ¬¡ä¸»è¦ä¿®æ”¹åŒºåŸŸ ---\n\n            processed_scenario = {\n \
          \               \"question_turns\": formatted_question_list, # ä¼ é€’å¤„ç†å¥½çš„å¯¹è¯åˆ—è¡¨\n\
          \                \"dialogue_turns_text_only\": dialogue_turns, # ä¿ç•™åŸå§‹å¯¹è¯ç”¨äºå®¡æ ¸\n\
          \                \"prompt_for_user_cn\": scenario.get(\"prompt_for_user_cn\"\
          , \"\"),\n                \"correct_answer_en\": scenario.get(\"correct_answer_en\"\
          , \"\")\n            }\n            processed_scenarios.append(processed_scenario)\n\
          \n        except Exception as e:\n            print(f\"Error processing\
          \ a scenario: {e}\")\n            continue\n            \n    return {\"\
          processed_scenarios\": processed_scenarios}"
        code_language: python3
        desc: ''
        outputs:
          processed_scenarios:
            children: null
            type: array[object]
        selected: false
        title: åœºæ™¯å¤„ç†
        type: code
        variables:
        - value_selector:
          - '1753346134162'
          - text
          variable: llm_string_output
      height: 54
      id: '1753759688876'
      position:
        x: 1328.8658129030878
        y: 1154.2996047244285
      positionAbsolute:
        x: 1328.8658129030878
        y: 1154.2996047244285
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1753673197346'
          - output
          variable: éŸ³é¢‘é…å¯¹
        - value_selector:
          - '1753672437742'
          - output
          variable: å¯¹è¯ç†è§£
        - value_selector:
          - '17536688854790'
          - output
          variable: å¬éŸ³é‡ç»„
        - value_selector:
          - '1753342086794'
          - output
          variable: é€‰æ‹©åº”ç­”
        - value_selector:
          - '17533461952642'
          - output
          variable: å£è¯­åº”ç­”
        selected: false
        title: ç»“æŸ 6
        type: end
      height: 194
      id: '1754286021242'
      position:
        x: 2736.3415211040106
        y: 542.5780756868085
      positionAbsolute:
        x: 2736.3415211040106
        y: 542.5780756868085
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: 285.28755053450914
      y: 90.50526141403597
      zoom: 0.32113052002740944
